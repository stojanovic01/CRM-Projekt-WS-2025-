{% extends "base.html" %}
{% block content %}

<div class="page-header">
    <h1><span class="page-icon">ğŸ‘¥</span>Kontakte verwalten</h1>
    <div style="display: flex; gap: var(--space-md); align-items: center;">
        <form method="GET" action="{{ url_for('customers.list_customers') }}" style="display: flex; gap: 0.5rem; margin: 0;">
            <input type="search" name="search" placeholder="Suche Kontakte..." value="{{ search or '' }}" style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid rgba(0,0,0,0.1); background: var(--bg-primary); min-width: 250px;">
            <button type="submit" class="btn btn-primary" style="padding: 0.5rem 1rem; margin: 0;">Suchen</button>
            {% if search %}
            <a href="{{ url_for('customers.list_customers') }}" class="btn btn-secondary" style="padding: 0.5rem 1rem;">âœ•</a>
            {% endif %}
        </form>
        <button class="btn btn-primary" onclick="showAddForm()">
            <span class="btn-icon">â•</span>Neuen Kontakt hinzufÃ¼gen
        </button>
    </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash-messages">
      {% for message in messages %}
        <div class="flash-message flash-success">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Add/Edit Customer Form -->
<div id="customerForm" class="form-container" style="display: none;">
    <div class="form-card">
        <h3 id="formTitle">Neuen Kontakt hinzufÃ¼gen</h3>
        <form method="POST" action="{{ url_for('customers.add_customer') }}">
            <input type="hidden" id="customerId" name="customer_id" value="">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">Vorname *</label>
                    <input type="text" id="firstName" name="first_name" required>
                </div>
                <div class="form-group">
                    <label for="lastName">Nachname *</label>
                    <input type="text" id="lastName" name="last_name" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="email">E-Mail</label>
                    <input type="email" id="email" name="email">
                </div>
                <div class="form-group">
                    <label for="phone">Telefon</label>
                    <input type="tel" id="phone" name="phone">
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <span class="btn-icon">ğŸ’¾</span>Speichern
                </button>
                <button type="button" class="btn btn-secondary" onclick="hideForm()">
                    <span class="btn-icon">âŒ</span>Abbrechen
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Customers Table -->
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>E-Mail</th>
                <th>Telefon</th>
                <th>Erstellt am</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
            <tr>
                <td class="customer-name">{{ customer.first_name }} {{ customer.last_name }}</td>
                <td class="email">{{ customer.email or '-' }}</td>
                <td class="phone">{{ customer.phone or '-' }}</td>
                <td class="date">{{ customer.created_at|date if customer.created_at else '-' }}</td>
                <td class="actions">
                    <a class="btn btn-small btn-info" href="{{ url_for('customers.customer_detail', customer_id=customer.id) }}">
                        <span class="btn-icon">ğŸ‘ï¸</span>Ansehen
                    </a>
                        <button class="btn btn-small btn-edit" onclick="editCustomer({{ customer.id }}, '{{ customer.first_name|escapejs }}', '{{ customer.last_name|escapejs }}', '{{ (customer.email or '')|escapejs }}', '{{ (customer.phone or '')|escapejs }}')">

                        <span class="btn-icon">âœï¸</span>Bearbeiten
                    </button>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="empty-state">Keine Kontakte gefunden. FÃ¼gen Sie den ersten Kontakt hinzu!</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- JavaScript Form & Modal Handling -->
<script>
let editingCustomerId = null;

function showAddForm() {
    document.getElementById('formTitle').textContent = 'Neuen Kontakt hinzufÃ¼gen';
    document.getElementById('customerId').value = '';
    document.getElementById('firstName').value = '';
    document.getElementById('lastName').value = '';
    document.getElementById('email').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('customerForm').style.display = 'block';
    editingCustomerId = null;
}

function editCustomer(id, firstName, lastName, email, phone) {
    document.getElementById('formTitle').textContent = 'Kontakt bearbeiten';
    document.getElementById('customerId').value = id;
    document.getElementById('firstName').value = firstName;
    document.getElementById('lastName').value = lastName;
    document.getElementById('email').value = email;
    document.getElementById('phone').value = phone;
    document.getElementById('customerForm').style.display = 'block';
    editingCustomerId = id;
}

function hideForm() {
    document.getElementById('customerForm').style.display = 'none';
    editingCustomerId = null;
}

// Hide flash messages after 5 seconds
setTimeout(function() {
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(msg => {
        msg.style.opacity = '0';
        setTimeout(() => msg.remove(), 300);
    });
}, 5000);
</script>

{% endblock %}
